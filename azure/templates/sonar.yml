# SonarQube Template - Only Steps (No jobs!)
steps:

  - task: SonarQubePrepare@7
    condition: and(succeeded(), ne(variables['SKIP_SONAR'], 'true'))
    inputs:
      SonarQube: 'Sonar Service Connection'
      scannerMode: 'CLI'
      configMode: 'manual'
      cliProjectKey: $(SONAR_PROJECT_KEY)
      cliProjectName: $(SONAR_PROJECT_NAME)
      cliSources: '.'
      extraProperties: |
        sonar.javascript.lcov.reportPaths=./coverage/lcov.info
        sonar.projectVersion=$(PROJECT_VERSION)
        sonar.exclusions=src/_tests_/**,src/models/**
        sonar.qualitygate.wait=true
    displayName: 'SonarQube Prepare'

  - task: SonarQubeAnalyze@7
    condition: and(succeeded(), ne(variables['SKIP_SONAR'], 'true'))
    inputs:
      jdkversion: 'JAVA_HOME_21_X64'
    displayName: 'SonarQube Analyze'

  - task: SonarQubePublish@7
    condition: and(succeeded(), ne(variables['SKIP_SONAR'], 'true'))
    inputs:
      pollingTimeoutSec: '300'
    displayName: 'SonarQube Publish'
